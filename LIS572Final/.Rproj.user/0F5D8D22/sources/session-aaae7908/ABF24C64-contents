---
title: "LIS572Final Project: Singapore Biographical Database Social Network Visualization" 
output: html_document
date: "2024-12-08"
author: "Doreen Chen"
---

```{r visNetwork, echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr)
library(stringr)
library(visNetwork)
library(igraph)
library(RColorBrewer)
library(tidyr)
data2 <- read.csv("../data/persondata.csv", quote = "", row.names = NULL, stringsAsFactors = FALSE)
data <- read.csv("../data/relationshipdata.csv", quote = "", row.names = NULL, stringsAsFactors = FALSE)
data <- data %>%
  left_join(data2, by = c("source" = "Chinese")) %>%
  mutate(pinyinsource = ifelse(!is.na(pinyin), pinyin, source))
data <- data %>%
  left_join(data2 %>% 
              rename(pinyin_target = pinyin), by = c("target" = "Chinese")) %>%
  mutate(pinyintarget = ifelse(!is.na(pinyin_target), pinyin_target, target))
data <- data %>% 
  select(-source, -target, -pinyin, -pinyin_target)
data <- data %>%
  mutate(pinyinsource = case_when(
    pinyinsource == "林志义" ~ "Lin Zhiyi",
    pinyinsource == "林天尧" ~ "Lin Tianyao",
    pinyinsource == "洪锦绰" ~ "Hong Jinchuo",
    TRUE ~ pinyinsource
  ))
data <- data %>%
  mutate(pinyintarget = case_when(
    pinyintarget == "转道法师／老和尚" ~ "Zhuandao Fashi/Laoheshang",
    pinyintarget == "张乞" ~ "Zhang Qi",
    pinyintarget == "珊顿•汤姆士" ~ "Shandun Tangmushi",
    pinyintarget == "黄树芳" ~ "Huang Shufang", 
    pinyintarget == "陈季骗" ~ "Chen Jipian",
    pinyintarget == "曾金福" ~ "Zeng Jinfu",
    TRUE ~ pinyintarget
  ))
nodes <- data.frame(unique(c(data$pinyinsource, data$pinyintarget)))
colnames(nodes) <- c("id")
nodes <- nodes %>% mutate(label = nodes$id) %>% distinct(id,label)
nodes$id <- nodes$label
edges <- data %>% select(pinyinsource, pinyintarget, relclas)
colnames(edges) <- c("from","to","label")
edges <- edges %>% mutate(color = label)
edges <- edges %>% mutate(color = str_replace_all(color, c("三代以内直系血亲及夫妻"= "darkred", "普通伙伴" = "green","普通亲戚" = "pink","轻度社交" = "lightgreen","密切伙伴"="darkgreen")))
edges <- edges %>% select(-label)
visNetwork(nodes, edges, main = 'Singapore Chinese Personalities Database Social Network') %>%  
          visPhysics(stabilization = TRUE) %>% 
  visOptions(highlightNearest=TRUE,
             nodesIdSelection=TRUE) %>% 
  visLegend(
    enabled = TRUE,
    addEdges = data.frame(
      label = c("Blood related and couple", "Close friend","relative","friend", "acquaintance"),
      color = c("darkred", "darkgreen", "pink", "lightgreen","darkgray")))%>% 
  visNodes(size = 5, color = list(highlight = "yellow"))
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

